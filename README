Google Analytics extension for MediaWiki
========================================

This extension adds the Google Analytics tracking snippet to every page.

**Please note**: this is a fork of [Extension:GoogleAnalytics](https://www.mediawiki.org/wiki/Extension:Google_Analytics_Integration).
The following differences exist:
- Somewhat different code structure
- We have a few more options (see [#Configuration]):
  - Options for setting cookie path / domain
  - Enhanced Link Attribution
  - Remarketing plugin
  - Tracking user groups using a custom dimension


## Configuration ##

### Configuration options
  
| Variable                                  | Value | Explanation                                                                                                                                                                    |
|-------------------------------------------|-------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| $wgGoogleAnalyticsAccount                 | null  | Your analytics account number (e.g. "UA-12345678-1")                                                                                                                           |
| $wgGoogleAnalyticsAnonymizeIP             | true  | Instruct Google anonymize the user's IP (by removing the last octet, or last 80 bits of IPv6 address) before any additional processing on Google's servers; see [anonymizeIp]. |
| $wgGoogleAnalyticsCookiePath              | null  | Useful if you need to [restrict tracking to a single sub-directory]; set to something like '/tracked-dir'.                                                                       |
| $wgGoogleAnalyticsEnahncedLinkAttribution | false | Enables [Enhanced Link Attribution]. You also need to [enable Enhanced Link Attribution in the reports interface].                                                             |
| $wgGoogleAnalyticsSegmentByGroup          | false | Push the user's groups into a custom var, allowing later segmentation in the GA dashboard. See ```$wgGoogleAnalyticsSegmentByGroupDimension``` as well.                        |
| $wgGoogleAnalyticsSegmentByGroupDimension | 1     | If $wgGoogleAnalyticsSegmentByGroup is enabled, this is used to determine the custom dimension number to be used.                                                              |
| $wgGoogleAnalyticsTrackExtLinks           | true  | Track clicks on external links (including interwiki and interlanguage) using non-interaction events.                                                                           |
| $wgGoogleAnalyticsRemarketing             | false | Enables remarketing and advertising reporting. You also need to [enable remarketing in property settings]. You can read more about [remarketing in Google Analytics].          |
| $wgGoogleAnalyticsPageGrouping            | false | Kol-Zchut specific! Classify pages into Content Groups, based on the first 2 visible categories. You must set up content groups in advance.                                    |  

[anonymizeIp]: https://support.google.com/analytics/answer/2763052
[enable remarketing in property settings]: https://support.google.com/analytics/answer/2444872
[remarketing in Google Analytics]: https://support.google.com/analytics/answer/2611268
[Enhanced Link Attribution]: https://support.google.com/analytics/answer/2558867
[enable Enhanced Link Attribution in the reports interface]: https://support.google.com/analytics/answer/2558867#EnableEnhancedLinkAttribution
[restrict tracking to a single sub-directory]: https://support.google.com/analytics/answer/6205202#subDirectoriesShareCookies

### Exemption from tracking
Users with the "noanalytics" right are exempt from tracking; by default this is applied only to bots.


## Roadmap
- Update the extension to MediaWiki 1.25 loading standard (extension.json)
- Create a new hook so can split out Kol-Zchut-specific parts

## Changelog ##

### v3.3.0
- Finally switch to Universal Analytics (which upstream did long ago)
- Move external link tracking to a ResourceLoader module


### v3.2.6
Bugfix: $wgGoogleAnalyticsOtherCode was added even if user/page were excluded.

### v3.2.5
- Improved documentation
- Partial rebase (we still much diverge) against upstream (v3.0.1):
    * Allow to ignore namespaces and specific pages/special pages
      ($wgGoogleAnalyticsIgnoreNsIDs, $wgGoogleAnalyticsIgnorePages, $wgGoogleAnalyticsIgnoreSpecials)
    * add $wgGoogleAnalyticsOtherCode to add any other analytics code desired.
	* we still use the older ga.js

### v3.2.4
Track interwiki & interlanguage links

### v3.2.3
use the "noanalytics" group permission to exempt users from tracking, instead of the
previous ```$wgGoogleAnalyticsIgnoreGroups```.

### v3.2.2
Make sure ```_setAccount``` is always first, in case another extension pushes something before this loads

### v3.2.1
Bug fixes for Page Grouping

### v3.2.0
Optional external links tracking (on by default), Page Grouping by categories

### v3.1.0
Optional ["Enhanced Link Attribution"](https://support.google.com/analytics/answer/2558867)
